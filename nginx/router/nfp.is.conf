# Configuration file for nfp.is.
# Generated by salt.nfp.is. DO NOT MODIFY

upstream www {
{%- for server, ips in salt['mine.get']('roles:www', 'network.ip_addrs', expr_form='grain').items() %}
{%- for ip in ips %}
    server {{ ip }}; #{{server}}
{%- endfor %}
{%- endfor %}
}

{%- for host in ['www.nfp.is', 'nfpencodes.com', 'www.nfpencodes.com'] %}
server {
    listen 80;
    server_name {{ host }};
    return 301 $scheme://nfp.is$request_uri;
}
{%- endfor %}

server {
    listen       80;
    server_name  nfp.is;

    location / {
        proxy_pass http://www;
    }
}

server {
    listen       443 ssl;
    server_name  www.nfp.is;

    ssl_certificate  nfp.is.crt;
    ssl_certificate_key   nfp.is.key;

    ssl_prefer_server_ciphers On;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'AES128+EECDH:AES128+EDH:!aNULL';

    return 301 $scheme://nfp.is$request_uri;
}

server {
    listen       443 ssl;
    server_name  nfp.is;

    ssl_certificate  nfp.is.crt;
    ssl_certificate_key   nfp.is.key;

    ssl_prefer_server_ciphers On;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'AES128+EECDH:AES128+EDH:!aNULL';

    location / {
        proxy_pass http://www;
    }
}

