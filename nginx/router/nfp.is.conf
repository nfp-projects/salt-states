# Configuration file for nfp.is.
# Generated by salt.nfp.is. DO NOT MODIFY

upstream www {
{%- for server, ips in salt['mine.get']('roles:www', 'network.ip_addrs', expr_form='grain').items() %}
{%- for ip in ips %}
    server {{ ip }}; #{{server}}
{%- endfor %}
{%- endfor %}
}

{%- for host in ['www.nfp.is', 'nfpencodes.com', 'www.nfpencodes.com'] %}
server {
    listen 80;
    server_name {{ host }};
    return 301 $scheme://nfp.is$request_uri;
}
{%- endfor %}

server {
    listen       80;
    server_name  nfp.is;

    location / {
        proxy_pass http://www;
    }
}

