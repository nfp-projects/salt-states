# Configuration file for nfp.is.
# Generated by salt.nfp.is. DO NOT MODIFY

upstream api {
{%- for server, ips in salt['mine.get']('roles:api', 'network.ip_addrs', expr_form='grain').items() %}
{%- for ip in ips %}
    server {{ ip }}; #{{server}}
{%- endfor %}
{%- endfor %}
}

server {
    listen       80;
    server_name  api.nfp.is;

    location / {
        proxy_pass http://api;
    }
}

server {
    listen       443 ssl;
    server_name  api.nfp.is;

    ssl_certificate  nfp.is.crt;
    ssl_certificate_key   nfp.is.key;

    ssl_prefer_server_ciphers On;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers 'AES128+EECDH:AES128+EDH:!aNULL';

    location / {
        proxy_pass http://api;
    }
}

